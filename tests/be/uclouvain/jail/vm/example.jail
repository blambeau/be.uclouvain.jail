load be.uclouvain.fa.StandardAlgo;

/** Load a DFA from FSP expression */
A = dfa <§fsp 
  INIT = a->b->INIT
       | b->a->INIT. 
§>;


B =  relabel A, labeling:{b -> tau}
  -> tmoves    epsilon:{tau}
  -> minimize
  -> determinize
  ;

A = (load <§fsp INIT = a->b->INIT | b->a->INIT. §>);

B = (minimize 
		(determinize 
			(tmoves 
				(relabel (A) labeling:{b -> tau})
			)
		)
	);

B = A
  -> relabel labeling:{b -> tau}
  -> tmoves  epsilon:{tau}
  -> determinize
  -> minimize
  ;
  
C = (compose (A) (B))
  ;
  
A = (compose 
		(load <§ INIT=a->b->INIT | b->a->INIT §>
		      :format='fsp')
        (load <§ FALSE = a->TRUE  | b->FALSE,
                  TRUE = b->FALSE | a->TRUE. §>
		      :format='fsp')
	:state @isOk = existing(@id)
  ;

A = (compose 
		<§fsp INIT=a->b->INIT | b->a->INIT §>
        <§fsp FALSE = a->TRUE  | b->FALSE,
               TRUE = b->FALSE | a->TRUE §>
	:state @isOk = existing(@id)
  ;
  
B = (dialect.print 
	    (copy (A) :state @shape = when @isAccepting=true then 'doublecircle'
		                          else 'circle',
			             @color = when @isError=true then 'red'
			                      when @isInitial=true then 'green'
			                      else 'white',
   			             @label = @id
			      :edge @label = @letter)
		:format='dot')
  ;
 
C = (minimize 
		(copy (B)
  		      :state /@pid = when @isAccepting=true then 1
  		                     when @isError=true then 2
  		                     else 3/)
     :partition = @pid)
  ;
 

alias print <E>, @format='dot' = 
		copy E :state /@shape = when @isAccepting=true then 'doublecircle'
		                        else 'circle',
		               @color = when @isError=true then 'red'
		                        when @isInitial=true then 'green'
		                        else 'white',
		               @label = @id/
		        :edge /@label = @letter/
     -> dialect.print :format='dot'
;

alias print <E>, @format='dot' = 
		(dialect.print 
			(copy (E) :state /@shape = when @isAccepting=true then 'doublecircle'
			                           else 'circle',
			                  @color = when @isError=true then 'red'
			                           when @isInitial=true then 'green'
			                           else 'white',
   			                  @label = @id/
			           :edge /@label = @letter/)
		:format='dot')
;

